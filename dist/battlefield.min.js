/**
 * Battlefield Game v1.0.0
 * This is classic game Battlefield for browsers, implemented on language JavaScript.
 * 
 * repository: git+https://github.com/alx2das/battlefield-js.git
 * bugs: [object Object]
 * 
 * Copyright 2017, Alexandr Builov
 * Date: Wed Feb 01 2017
 */
!function(e){"use strict";function t(e,r){if(o instanceof t)return o;if(o=this,"object"==typeof r){for(var i in l)n[i]=r.hasOwnProperty(i)?r[i]:l[i];n=Object.assign(n,s)}else n=Object.assign(l,s);n.htmlSelector=document.querySelector(e),this.setLevel(c)}function r(){if(n.fSize.h<10||n.fSize.h>25||n.fSize.v<10||n.fSize.v>25)throw new RangeError(f.getMessage("err_size_field"));if(!(n.fBarrier instanceof Array)||n.fBarrier.length<1)throw new RangeError(f.getMessage("err_barrier"));this.fields=[],this.fName=[n.player.kUser,n.player.kBrain];for(var e in n.player){for(var t=n.player[e],r=new Array(n.fSize.v),i=0;i<n.fSize.v;i++){r[i]=new Array(n.fSize.h);for(var a=0;a<n.fSize.h;a++)r[i][a]=n.tPoint.DEF}this.fields[t]=r}}function i(e,r,i){function l(){for(var e=[],t=0;t<n.fSize.h;t++)for(var r=0;r<n.fSize.v;r++)e.push([r,t]);return e}function s(){var e=0;return n.fBarrier.forEach(function(t){e+=t[0]*t[1]}),e}if(!(r instanceof t))throw new Error("Invalid Battlefield object in the construct Battle");a.apply(this,arguments),this.fields=e,this.battlefield=r,this._lsKill=[],this._lsShot=[],this._ctnCell=[];for(var o in n.player){var c=n.player[o];this._lsKill[c]=[],this._lsShot[c]=l(),this._ctnCell[c]=s()}this.userKey=n.player.kUser,this.enemyKey=n.player.kBrain,this.player=f.rand(1,2)%2?this.userKey:this.enemyKey,this.game(this.player)}function a(e,t){if(null==n.htmlSelector)throw new Error(f.getMessage("err_invalid_selector"));this.fields=e,this.battlefield=t;var r=this,i='<div class="left">   <a href="#">Battlefield</a></div><div class="right">   <span class="js" id="new_game">'+f.getMessage("new_game")+'</span>   <span class="js" id="config">'+f.getMessage("options")+"</span></div>";if(n.htmlSelector.innerHTML="",n.printName){var a=n.winner.kUser+n.winner.kBrain!=0;i+='<div class="center"><span class="name" id="'+n.player.kUser+'">'+f.getPlayerName(n.player.kUser)+"</span>"+(a?'<span class="total" id="'+n.player.kUser+'">'+n.winner.kUser+"</span>":"")+"<span>&</span>"+(a?'<span class="total" id="'+n.player.kBrain+'">'+n.winner.kBrain+"</span>":"")+'   <span class="name" id="'+n.player.kBrain+'">'+f.getPlayerName(n.player.kBrain)+"</span></div>"}if(this.nameHtml=document.createElement("div"),this.nameHtml.setAttribute("class","bf-player-name"),this.nameHtml.innerHTML=i,n.htmlSelector.appendChild(this.nameHtml),this.fieldHtml=document.createElement("div"),this.fieldHtml.setAttribute("class","bf-fields"),this.fieldHtml.innerHTML=this.getFieldHTML(n.player),n.htmlSelector.appendChild(this.fieldHtml),n.printLog){var l='<div class="bf-filter no-active">   <b>'+f.getMessage("filter")+':</b>   <span class="js" id="'+n.player.kUser+'">'+f.getPlayerName(n.player.kUser)+'</span>   <span class="js" id="'+n.player.kBrain+'">'+f.getPlayerName(n.player.kBrain)+'</span>   <span class="js active" id="full">'+f.getMessage("full")+"</span></div>";this.logFilter=null,this.actFilter="",this.logHtml=document.createElement("div"),this.logHtml.setAttribute("class","bf-logger"),this.logHtml.innerHTML="<h2>"+f.getMessage("info_log_title")+l+"</h2><ul></ul>",n.htmlSelector.appendChild(this.logHtml)}document.getElementById("new_game").onclick=function(){r.battlefield.run()},document.getElementById("config").onclick=function(){r.battlefield.updateConfig()}}var n={},l={printName:!0,printLog:!0,printHelp:!0,fSize:{h:15,v:15},fBarrier:[[5,2],[4,3],[3,4],[2,5]],fMarker:{h:"number",v:"char"}},s={player:{kUser:"FUser",kBrain:"FBrain"},winner:{kUser:0,kBrain:0},tPoint:{DEF:0,BAR:1,KIL:2,NUL:3}},o=!1,c="middle";t.prototype.run=function(){try{var e=new r,t=e.setBarrier();new i(t,this)}catch(e){f.showExceptions(e)}},t.prototype.getLevel=function(e){var t={easy:{fSize:{h:10,v:10},fBarrier:[[4,1],[3,2],[2,3],[1,4]]},middle:{fSize:{h:15,v:15},fBarrier:[[5,2],[4,3],[3,4],[2,5],[1,6]]},hard:{fSize:{h:15,v:20},fBarrier:[[6,1],[5,2],[4,3],[3,4],[2,5],[1,6]]}};if("object"==typeof t[e])return t[e];throw new Error(f.getMessage("err_invalid_level"))},t.prototype.setLevel=function(e){var t=this.getLevel(e);return n.fSize=t.fSize,n.fBarrier=t.fBarrier,c=e,this},t.prototype.updateConfig=function(){function e(e){s.querySelector("#opt-fsize").querySelectorAll("label").forEach(function(t){var r=t.querySelector("input");e?(t.classList="",r.disabled=!1):(t.classList="no-act",r.disabled=!0)}),s.querySelector("#opt-fbarrier").querySelectorAll("label").forEach(function(t){var r=t.querySelector("input");e?(t.classList="",r.disabled=!1):(t.classList="no-act",r.disabled=!0)})}function t(){var e={fSize:{h:0,v:0},fBarrier:[]};return e.fSize.h=parseInt(s.querySelector("input#type-h").value),e.fSize.v=parseInt(s.querySelector("input#type-v").value),s.querySelector("#opt-fbarrier").querySelectorAll("label").forEach(function(t){var r=t.querySelector("input"),i=parseInt(r.getAttribute("bar")),a=parseInt(r.value);a>0&&e.fBarrier.push([i,a])}),e}function r(e){s.querySelector("input#type-h").value=e.fSize.h,s.querySelector("input#type-v").value=e.fSize.v,s.querySelector("#opt-fbarrier").querySelectorAll("input").forEach(function(e){e.value=0}),e.fBarrier.forEach(function(e){var t=e[0],r=e[1];s.querySelector("#opt-fbarrier").querySelector("input#bar_"+t).value=r})}var i=this,a='<table class="bf-config">   <tr>       <td class="name top">Уровень сложности:</td>       <td class="options" id="config_level">           <button class="btn '+("easy"==c?"active":"")+'" value="easy">Легкий</button>           <button class="btn '+("middle"==c?"active":"")+'" value="middle">Средний</button>           <button class="btn '+("hard"==c?"active":"")+'" value="hard">Сложный</button>           <button class="btn rg '+("user"==c?"active":"")+'" value="user">Настроить</button>       </td>   </tr>   <tr><td colspan="2"><div class="border"></div></td></tr>   <tr>       <td class="name">Размер поля:</td>       <td class="options no-label" id="opt-fsize">           <label class="no-act" data-type="h">Горизонтально: <input type="number" id="type-h" min="10" max="25" value="15" disabled></label>           <label class="no-act" data-type="v">Вертикально: <input type="number" id="type-v" min="10" max="25" value="15" disabled></label>       </td>   </tr>   <tr>       <td class="name">Корабли на поле</td>       <td class="options no-label" id="opt-fbarrier">           <label class="no-act">6&nbsp;&nbsp;/ <input type="number" id="bar_6" bar="6" value="1" min="0" max="6" disabled /></label>           <label class="no-act">5&nbsp;&nbsp;/ <input type="number" id="bar_5" bar="5" value="2" min="0" max="6" disabled /></label>           <label class="no-act">4&nbsp;&nbsp;/ <input type="number" id="bar_4" bar="4" value="3" min="0" max="6" disabled /></label>           <label class="no-act">3&nbsp;&nbsp;/ <input type="number" id="bar_3" bar="3" value="4" min="0" max="6" disabled /></label>           <label class="no-act">2&nbsp;&nbsp;/ <input type="number" id="bar_2" bar="2" value="5" min="0" max="6" disabled /></label>           <label class="no-act">1&nbsp;&nbsp;/ <input type="number" id="bar_1" bar="1" value="6" min="0" max="6" disabled /></label>       </td>   </tr></table>';a="<form>"+a+"</form>";var l=c;f.modalWindow(f.getMessage("options"),a,[{elValue:f.getMessage("new_game"),onClick:function(e){e.close();try{if("user"==l){var r=t();n.fSize=r.fSize,n.fBarrier=r.fBarrier,c=l}else l.length>0&&l!=c&&i.setLevel(l);i.run()}catch(e){f.showExceptions(e)}}},{elValue:f.getMessage("set_default_params"),elClass:"btn-warning",onClick:function(e){i.setLevel("middle"),i.run(),e.close()}},{elValue:f.getMessage("close"),elClass:"btn-danger",onClick:function(e){e.close()}}]);var s=document.querySelector(".bf-config"),o=document.getElementById("config_level").querySelectorAll("button");e("user"==c),r(n),o.forEach(function(t){t.onclick=function(t){return l=t.target.value,o.forEach(function(e){e.classList.remove("active")}),t.target.classList+=" active","user"==l?e(!0):(e(!1),r(i.getLevel(l))),!1}})},r.prototype.setBarrier=function(){function e(r,a){if(!(i>0))throw new RangeError(f.getMessage("err_max_iteration"));i--;for(var l=[],s=f.rand(0,n.fSize.v-1),o=f.rand(0,n.fSize.h-1),c=f.rand(1,2)%2,u=0;u<r;u++){var d=s,h=o;if(c?d=s+u:h=o+u,!t(d,h,a))return e(r,a);l.push([d,h])}return l.forEach(function(e){var t=e[0],r=e[1];a[t][r]=n.tPoint.BAR}),a}function t(e,t,r){var i=[[-1,0],[-1,-1],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1]],a=0,l=0,s=n.fSize.v-1,o=n.fSize.h-1;if(e<0||e>s||t<0||t>o)return!1;if(r[e][t]!==n.tPoint.DEF)return!1;for(var c=0;c<i.length;c++)if(a=e+i[c][0],l=t+i[c][1],a>=0&&a<=s&&l>=0&&l<=o&&r[a][l]!=n.tPoint.DEF)return!1;return!0}var r=this,i=100*this.fName.length;return this.fName.forEach(function(t){var i=r.fields[t];n.fBarrier.forEach(function(t){for(var r=t[0],a=t[1],n=0;n<a;n++)i=e(r,i)}),r.fields[t]=i}),this.fields},i.prototype=Object.create(a.prototype),i.prototype.game=function(e){try{switch(this.showProgress(e),this.player=e,e){case this.userKey:this.shotUser();break;case this.enemyKey:this.shotAI(this.userKey);break;default:throw new Error(f.getMessage("err_invalid_player"))}}catch(e){f.showExceptions(e)}},i.prototype.shotUser=function(){var e=this;this.clickToField(this.enemyKey,function(t){if(e.player!==e.userKey)return!1;try{var r=t.target.parentNode.cellIndex,i=t.target.parentNode.parentNode.rowIndex;e.shot([i,r],e.enemyKey)}catch(t){e.game(e.userKey)}})},i.prototype.shotAI=function(e){function t(){var l=[];if(i._lsKill[e].length>0)l=r();else{var o=f.rand(0,i._lsShot[e].length-1);l=i._lsShot[e][o],i._lsShot[e].splice(o,1)}if(l instanceof Array&&"undefined"!==l[0]&&"undefined"!==l[1]){var c=l[0],u=l[1];if(c>=0&&c<n.fSize.v&&u>=0&&u<n.fSize.h&&(a[c][u]!==s.NUL||a[c][u]!==s.BAR))return l}return t()}function r(){var t=[[-1,0],[0,-1],[1,0],[0,1]],r=i._lsKill[e],n=[],o=0,c=0;if(1==r.length){var u=r[0][0],d=r[0][1];for(t=f.shuffle(t),o=0;o<t.length;o++){var h=u+t[o][0],p=d+t[o][1];if(h>=0&&h<l.v&&p>=0&&p<l.h&&a[h][p]!==s.NUL)return[h,p]}}else{var v=r[0][0]==r[1][0],m=l.h+l.v,g=0;for(o=0;o<r.length;o++)c=v?r[o][1]:r[o][0],m=m>c?c:m,g=g<c?c:g;var y=f.rand(1,2)%2?m-1:g+1;n=v?[r[0][0],y]:[y,r[0][1]]}return n}var i=this,a=this.fields[e],l=n.fSize,s=n.tPoint,o=t();setTimeout(function(){i.shot(o,e)},300)},i.prototype.shot=function(e,t){function r(e,t){var r=e[0],i=e[1];switch(a.fields[t][r][i]){case n.tPoint.DEF:return!1;case n.tPoint.BAR:return!0;default:return null}}function i(e,t){function r(e,t){var a=e[0],l=e[1],f=!1,u=!1,d=[];"object"==typeof t&&(f=t[0],u=t[1]);for(var h=0;h<i.length;h++){var p=a+i[h][0],v=l+i[h][1];if(p===f&&v===u);else if(p>=0&&p<n.fSize.v&&v>=0&&v<n.fSize.h){var m=s[p][v];if(m==n.tPoint.BAR)return!1;m==n.tPoint.KIL?(c.push([p,v]),d.push([[p,v],[a,l]])):o.push([p,v])}}if(0===d.length)return!0;for(var g=0,y=0;y<d.length;y++){if(!r(d[y][0],d[y][1]))return!1;g++}return g==d.length}var i=[[-1,0],[-1,-1],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1]],s=a.fields[t],o=[],c=[];return!!r(e)&&(c.push(e),l=c,o)}var a=this,l=0,s=t==this.userKey?this.enemyKey:this.userKey,o=e[0],c=e[1],f=r(e,t);if("boolean"==typeof f)if(f){this._ctnCell[t]--,this.fields[t][o][c]=n.tPoint.KIL;var u=i(e,t);"boolean"==typeof u?(this._lsKill[t].push(e),this.setMarker(e,t,n.tPoint.KIL),this.setHelpMarker(e,t,function(e){var r=e[0],i=e[1];a.fields[t][r][i]=n.tPoint.NUL})):(this._lsKill[t]=[],u.forEach(function(e){var r=e[0],i=e[1];n.printHelp&&(a.setMarker(e,t,n.tPoint.NUL,!0),a.fields[t][r][i]=n.tPoint.NUL),s==n.player.kBrain&&(a.fields[t][r][i]=n.tPoint.NUL)}),this.setMarker(e,t,n.tPoint.KIL+"_death"),this.shipInfoMap(l,t)),0===this._ctnCell[t]?(this.player=!1,this.gameOver(s)):this.game(s)}else this.fields[t][o][c]=n.tPoint.NUL,this.setMarker(e,t,n.tPoint.NUL),this.game(t);else this.game(s)},a.prototype.getFieldHTML=function(e){function t(e,t){t=t||!1;var r="";r+='<table class="field" id="'+e+'">';for(var a=0;a<n.fSize.v;a++){r+="<tr>";for(var l=0;l<n.fSize.h;l++){var s="",o="";if(n.fMarker!==!1&&"object"==typeof n.fMarker){var c="undefined"!=typeof n.fMarker.h&&"char"==n.fMarker.h?f.getLetter(l):l+1,u="undefined"!=typeof n.fMarker.v&&"char"==n.fMarker.v?f.getLetter(a):a+1;s=0===a?'<div class="mm">'+c+"</div>":"",o=0===l?'<div class="ll">'+u+"</div>":""}var d="";t&&(d=i[e][a][l]==n.tPoint.BAR?" let":""),r+="<td>"+s+o+'<div class="box'+d+'"></div></td>'}r+="</tr>"}return r+="</table>"}function r(e){var t="";return n.fBarrier.forEach(function(e){for(var r="",i=0;i<e[0];i++)r+='<div class="box"></div>';t+='<div class="let" id="cell_'+e[0]+'">   <span data-ctn="'+e[1]+'">x'+e[1]+"</span>   "+r+"</div>"}),'<div class="list-let" id="'+e+'">'+t+"</div>"}var i=this.fields,a="";for(var l in e){var s=e[l],o=s==n.player.kUser?"lf":"rg",c="lf"==o;a+='<div class="board '+o+'">',a+=t(s,c),a+=r(s),a+="</div>"}return a},a.prototype.showProgress=function(e){return e?(this.fieldHtml.querySelectorAll("table.field.timeout").forEach(function(e){e.classList.remove("timeout")}),this.fieldHtml.querySelector("table.field#"+e).classList.add("timeout"),n.printName?(this.nameHtml.querySelectorAll(".name").forEach(function(e){e.classList.remove("act")}),void this.nameHtml.querySelector(".name#"+e).classList.add("act")):null):(this.fieldHtml.querySelectorAll("table.field").forEach(function(e){e.classList.add("timeout")}),n.printName&&this.nameHtml.querySelectorAll(".name").forEach(function(e){e.classList.remove("act")}),!1)},a.prototype.clickToField=function(e,t){this.fieldHtml.querySelector("table.field#"+e).onclick=t},a.prototype.setMarker=function(e,t,r,i){var a=e[0],l=e[1],s="";switch(i=i||!1,r){case n.tPoint.NUL:s=i?"auto-null":"null";break;case n.tPoint.KIL:s="kill";break;case n.tPoint.KIL+"_death":s="kill";break;default:return null}i||this.printLog(e,t,r);var o=this.fieldHtml.querySelector("table.field#"+t).rows[a].cells[l];if(o.querySelector(".box").className+=" "+s,!i){var c=document.createElement("div");c.setAttribute("class","shot"),o.appendChild(c),f.animateOpacity(c,2e3)}},a.prototype.setHelpMarker=function(e,t,r){if(!n.printHelp)return!1;for(var i=[[-1,-1],[1,-1],[1,1],[-1,1]],a=e[0],l=e[1],s=0;s<i.length;s++){var o=a+i[s][0],c=l+i[s][1];o>=0&&o<n.fSize.v&&c>=0&&c<n.fSize.h&&(this.setMarker([o,c],t,n.tPoint.NUL,!0),"function"==typeof r&&r([o,c],t))}},a.prototype.shipInfoMap=function(e,t){var r=e.length,i=this.fieldHtml.querySelector(".list-let#"+t).querySelector("#cell_"+r),a=i.querySelector("span"),n=parseInt(a.getAttribute("data-ctn"))-1;a.setAttribute("data-ctn",n),a.innerHTML="x"+n;var l=document.createElement("div");if(l.setAttribute("class","shot"),a.appendChild(l),f.animateOpacity(l,3e3),0==n){var s=i.querySelectorAll("div");s.forEach(function(e){e.className+=" kill"})}var o=this.fieldHtml.querySelector(".field#"+t);e.forEach(function(e){var t=e[0],r=e[1];o.rows[t].cells[r].querySelector(".box").className+=" death"})},a.prototype.printLog=function(e,t,r){if(!n.printLog)return!1;var i=this,a="",l=e[0],s=e[1],o="",c="",u=t==n.player.kUser?f.getPlayerName(n.player.kBrain):f.getPlayerName(n.player.kUser),d=new Date,h=d.toLocaleTimeString(),p="";switch(r){case n.tPoint.KIL:o="war",c="log_kill";break;case n.tPoint.KIL+"_death":o="kil",c="log_death";break;case n.tPoint.NUL:o="nul",c="log_past"}p+="char"==n.fMarker.v?f.getLetter(l):l+1,p+="x",p+="char"==n.fMarker.h?f.getLetter(s):s+1,a+='<span class="point">'+p+'</span><span class="type '+o+'">'+f.getMessage(c)+'</span><span class="name">'+u+'</span><span class="time">'+h+"</span>";var v=document.createElement("li");if(v.setAttribute("id",t),v.setAttribute("data-x",l),v.setAttribute("data-y",s),this.actFilter==t&&v.setAttribute("class","no-active"),v.innerHTML=a,this.logHtml.querySelector("ul").insertBefore(v,this.logHtml.querySelector("ul").firstChild),v.onmouseover=function(e){if("LI"!=e.target.nodeName)return!1;var t=e.target.getAttribute("id"),r=e.target.getAttribute("data-x"),a=e.target.getAttribute("data-y"),n=i.fieldHtml.querySelector(".field#"+t).rows[r].cells[a],l=document.createElement("div");l.setAttribute("class","shot"),n.appendChild(l),v.onmouseout=function(){f.animateOpacity(l,1e3)}},null==this.logFilter){this.logFilter=this.logHtml.querySelector(".bf-filter"),this.logFilter.classList="bf-filter";var m=this.logFilter.querySelector("#full");this.logFilter.querySelectorAll("span").forEach(function(e){e.onclick=function(e){return m!=e.target&&(m&&m.classList.remove("active"),i.actFilter=e.target.getAttribute("id"),m=e.target,m.classList.add("active"),void i.logHtml.querySelectorAll("li").forEach(function(e){e.classList=i.actFilter==e.getAttribute("id")?"no-active":""}))}})}},a.prototype.showShip=function(e){for(var t=this.fields[e],r=this.fieldHtml.querySelector("table#"+e),i=0;i<t.length;i++)for(var a=0;a<t[i].length;a++)t[i][a]==n.tPoint.BAR&&(r.rows[i].cells[a].querySelector(".box").className+=" let")},a.prototype.gameOver=function(e){var t=this,r=n.player.kUser==e?"kUser":"kBrain",i="",a="",l="";n.winner[r]++,n.player.kUser==e?(a="winner",i=f.getMessage("you_winner"),l=f.getMessage("info_winner")):(this.showShip(e),a="lose",i=f.getMessage("you_lose"),l=f.getMessage("info_loser"));var s='<div class="bf-go-smile '+a+'"></div><div class="bf-go-text">   <h2>'+i+"</h2>   <h3>"+l+"</h3></div>";f.modalWindow(f.getMessage("game_over"),s,[{elValue:f.getMessage("new_game"),onClick:function(e){e.close(),t.battlefield.run()}},{elValue:f.getMessage("update_options"),elClass:"btn-warning",onClick:function(e){e.close(),t.showProgress(!1),t.battlefield.updateConfig()}},{elValue:f.getMessage("close"),elClass:"btn-danger",onClick:function(e){e.close(),t.showProgress(!1)}}])};var f={playerName:{def:{kUser:"Игрок",kBrain:"Компьютер"}},rand:function(e,t){return e=e||0,t=t||100,parseInt(Math.random()*(t-e+1)+e)},getLetter:function(e,t){var t=t||"",r="ABCDEFGHIJKLMNOPQRSTUVWXYZ";return e>r.length?f.getLetter(e-r.length,""==t?1:t+1):r[e]+t},shuffle:function(e){for(var t,r,i=0;i<e.length-1;i++)t=this.rand(0,e.length-1),r=e[t],e[t]=e[e.length-1],e[e.length-1]=r;return e},getMessage:function(e){var t={start_game:"Начать игру",new_game:"Новая игра",game_over:"Игра закончена",you_lose:"Ты проиграл",you_winner:"Ты выиграл",options:"Настройки",update_options:"Изменить настройки",close:"Закрыть",update_page:"Обновить страницу",set_default_params:"Настройки по умолчанию",save:"Сохранить",filter:"Фильтр",full:"Все",log_kill:"ранил",log_death:"убил",log_past:"мимо",err_invalid_selector:"Указанный HTML блок на странице не найден",err_max_iteration:"Не получилось установить корабли на игровое поле, измените настройки",err_invalid_player:"Неизвестный игрок",err_invalid_field:"Некорректное игровое поле",err_player_name:"Переданны не корректные ключи играков",err_size_field:"Игровое поле не должно быть меньше 10х10 или больше 25х25, измените настройки",err_barrier:"Не корректный список кораблей",err_invalid_level:"Указан несуществующий уровень сложности",info_log_title:"Состояние игрового поля",info_title_error:"Критическая ошибка",info_title_range_error:"Некорректные настройки",info_winner:"Замечательная победа,<br>попробуешь еще?",info_loser:"В следующий раз повезет больше,<br>попробуешь еще?"};return"string"==typeof t[e]&&t[e].length>0?t[e]:e},getPlayerName:function(e){var t=e==n.player.kUser?"kUser":"kBrain";return this.playerName.def[t]},showExceptions:function(e){var r="",i="",a=[];switch(e.name){case"Error":r=f.getMessage("info_title_error"),i=e.message,a=[{elValue:f.getMessage("set_default_params"),onClick:function(e){e.close();var r=new t(n.htmlSelector,n);r.setLevel("middle").run()}}];break;case"RangeError":r=f.getMessage("info_title_range_error"),i=e.message,a=[{elValue:f.getMessage("set_default_params"),onClick:function(e){e.close();var r=new t(n.htmlSelector,n);r.setLevel("middle").run()}}];break;default:r=e.name,i=e.message}this.modalWindow(r,i,a)},modalWindow:function(e,t,r){function i(e,t){return function(r){"function"==typeof t[e].onClick&&t[e].onClick(a,r)}}var a={font:!1,window:!1,construct:function(){if(this.createHTML().autoPosition(),!(r instanceof Array)||0==r.length)return this.window.querySelector(".footer").style.display="none",!1;for(var e=this.window.querySelector(".footer"),t=[],a=0;a<r.length;a++){var n=r[a],l="string"==typeof r[a].elClass?" "+n.elClass:"";t[a]=document.createElement("button"),t[a].setAttribute("class","btn"+l),t[a].setAttribute("id","btn_"+a),t[a].innerHTML=n.elValue,t[a].addEventListener("click",i(a,r),!1),e.appendChild(t[a])}},createHTML:function(){var r=document.querySelector(".bf-modal-font"),i=document.querySelector(".bf-modal-window");return null!=r&&document.body.removeChild(r),null!=i&&document.body.removeChild(i),this.font=document.createElement("div"),this.font.setAttribute("class","bf-modal-font"),this.window=document.createElement("div"),this.window.setAttribute("class","bf-modal-window"),this.window.innerHTML='<div class="content">   <div class="header">'+e+'</div>   <div class="cont">'+t+'</div>   <div class="footer"></div></div>',document.body.appendChild(this.font),document.body.appendChild(this.window),this},autoPosition:function(){var e=this.window.clientWidth/2,t=this.window.clientHeight/2;this.window.style.marginTop=t*-1+"px",this.window.style.marginLeft=e*-1+"px"},close:function(){document.body.removeChild(this.font),document.body.removeChild(this.window)}};a.construct()},animateOpacity:function(e,t){e.style.opacity=1;var r=setInterval(function(){if(e.style.opacity=e.style.opacity-100/(t/.1),e.style.opacity<=0){clearInterval(r);try{e.parentNode.removeChild(e)}catch(e){}}},1)}};e.Battlefield=t}(window);